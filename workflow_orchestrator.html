<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html"><link rel="search" title="Search" href="search.html"><link rel="next" title="SQLModel Generator" href="sqlmodel_generator.html"><link rel="prev" title="The Consensus Mechanism" href="concepts/consensus_mechanism.html">
        <link rel="prefetch" href="_static/logo.jpg" as="image">

    <link rel="shortcut icon" href="_static/logo.ico"><!-- Generated with Sphinx 8.2.3 and Furo 2025.09.25 -->
        <title>Workflow Orchestrator - Extrai 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=acfd86a5" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=580074bf" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle site navigation sidebar">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc" aria-label="Toggle table of contents sidebar">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <span class="icon"><svg><use href="#svg-menu"></use></svg></span>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">Extrai 1.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/logo.jpg" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">Extrai 1.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#worflow-overview">Worflow Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#key-features">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started: A Step-by-Step Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How-to Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how_to/generate_sql_model.html">How to Generate SQL Models from Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to/generate_example_json.html">How to Generate an Example JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to/customize_extraction_prompts.html">How to Customize Extraction Prompts</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to/handle_complex_data_with_hierarchical_extraction.html">How to Handle Complex Data with Hierarchical Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to/using_multiple_llm_providers.html">How to Use Multiple LLM Providers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="concepts/architecture_overview.html">Architecture Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts/consensus_mechanism.html">The Consensus Mechanism</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Workflow Orchestrator</a></li>
<li class="toctree-l1"><a class="reference internal" href="sqlmodel_generator.html">SQLModel Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_json_generator.html">Example JSON Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="analytics_collector.html">Analytics Collector</a></li>
<li class="toctree-l1"><a class="reference internal" href="llm_providers.html">LLM Providers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/modules.html">extrai</a><input aria-label="Toggle navigation of extrai" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="api/extrai.html">llm_consensus_extraction package</a><input aria-label="Toggle navigation of llm_consensus_extraction package" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><span class="icon"><svg><use href="#svg-arrow-right"></use></svg></span></label><ul>
<li class="toctree-l3"><a class="reference internal" href="api/extrai.core.html">llm_consensus_extraction.core package</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/extrai.llm_providers.html">llm_extraction_consensus.llm_providers package</a></li>
<li class="toctree-l3"><a class="reference internal" href="api/extrai.utils.html">llm_extraction_consensus.utils package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="genindex.html">Index</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/workflow_orchestrator.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle" aria-label="Toggle Light / Dark / Auto color theme">
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <span class="icon"><svg><use href="#svg-toc"></use></svg></span>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="workflow-orchestrator">
<span id="id1"></span><h1>Workflow Orchestrator<a class="headerlink" href="#workflow-orchestrator" title="Link to this heading">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">WorkflowOrchestrator</span></code> is the central component of the <code class="docutils literal notranslate"><span class="pre">extrai</span></code> library. It orchestrates the entire pipeline, from processing raw text documents to generating structured, database-ready SQLModel objects.</p>
<p>This component is responsible for:</p>
<ul class="simple">
<li><p>Generating prompts for LLMs based on your data schema.</p></li>
<li><p>Interacting with one or more LLMs to perform data extraction.</p></li>
<li><p>Running a consensus algorithm to merge multiple LLM outputs.</p></li>
<li><p>Hydrating the final JSON data into structured SQLModel objects.</p></li>
<li><p>Persisting these objects to a database session.</p></li>
</ul>
<section id="core-workflow">
<h2>Core Workflow<a class="headerlink" href="#core-workflow" title="Link to this heading">¶</a></h2>
<p>The typical workflow involves these steps:</p>
<ol class="arabic simple">
<li><p><strong>Initialization</strong>: You instantiate the <code class="docutils literal notranslate"><span class="pre">WorkflowOrchestrator</span></code> with your root data model (a SQLModel class) and at least one LLM client.</p></li>
<li><p><strong>Execution</strong>: You call either <code class="docutils literal notranslate"><span class="pre">synthesize()</span></code> or <code class="docutils literal notranslate"><span class="pre">synthesize_and_save()</span></code> with your input documents.</p></li>
<li><p><strong>Processing</strong>: The orchestrator sends the data to the LLM(s), gets back structured JSON, and runs the consensus process.</p></li>
<li><p><strong>Output</strong>: The final, clean data is returned as a list of hydrated SQLModel objects, ready for use in your application or already saved to the database.</p></li>
</ol>
</section>
<section id="initialization-and-configuration">
<h2>Initialization and Configuration<a class="headerlink" href="#initialization-and-configuration" title="Link to this heading">¶</a></h2>
<p>The constructor of the <code class="docutils literal notranslate"><span class="pre">WorkflowOrchestrator</span></code> is key to configuring its behavior.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">extrai.core</span> <span class="kn">import</span> <span class="n">WorkflowOrchestrator</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">extrai.core</span> <span class="kn">import</span> <span class="n">WorkflowOrchestrator</span>
<span class="kn">from</span> <span class="nn">your_models</span> <span class="kn">import</span> <span class="n">DepartmentModel</span>  <span class="c1"># Your root SQLModel</span>
<span class="kn">from</span> <span class="nn">your_llm_client</span> <span class="kn">import</span> <span class="n">llm_client</span>  <span class="c1"># An instance of a BaseLLMClient</span>

<span class="c1"># Initialize with default logger</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span>
    <span class="n">root_sqlmodel_class</span><span class="o">=</span><span class="n">DepartmentModel</span><span class="p">,</span>
    <span class="n">llm_client</span><span class="o">=</span><span class="n">llm_client</span><span class="p">,</span>
    <span class="n">num_llm_revisions</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">consensus_threshold</span><span class="o">=</span><span class="mf">0.51</span><span class="p">,</span>
    <span class="c1"># ... other parameters</span>
<span class="p">)</span>

<span class="c1"># Or with a custom logger</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;MyCustomLogger&quot;</span><span class="p">)</span>
<span class="n">orchestrator_with_logger</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span>
    <span class="n">root_sqlmodel_class</span><span class="o">=</span><span class="n">DepartmentModel</span><span class="p">,</span>
    <span class="n">llm_client</span><span class="o">=</span><span class="n">llm_client</span><span class="p">,</span>
    <span class="n">logger</span><span class="o">=</span><span class="n">logger</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Here are the parameters you can use:</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">root_sqlmodel_class</span></code></dt><dd><p>The main SQLModel class that serves as the entry point for data extraction. The orchestrator automatically discovers all related SQLModel classes through its relationships.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">Type[SQLModel]</span></code></p></li>
<li><p><strong>Example</strong>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tests.core.helpers.orchestrator_test_models</span> <span class="kn">import</span> <span class="n">DepartmentModel</span>

<span class="c1"># DepartmentModel has a relationship to EmployeeModel,</span>
<span class="c1"># so both will be part of the schema.</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span>
    <span class="n">root_sqlmodel_class</span><span class="o">=</span><span class="n">DepartmentModel</span><span class="p">,</span>
    <span class="n">llm_client</span><span class="o">=</span><span class="n">my_llm_client</span>
<span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">llm_client</span></code></dt><dd><p>An instance or a list of instances of an LLM client that conforms to the <code class="docutils literal notranslate"><span class="pre">BaseLLMClient</span></code> interface. Providing a list of clients enhances reliability; the orchestrator will rotate through them for each revision.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">Union[BaseLLMClient,</span> <span class="pre">List[BaseLLMClient]]</span></code></p></li>
<li><p><strong>Example</strong>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Single client</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">llm_client</span><span class="o">=</span><span class="n">client1</span><span class="p">)</span>

<span class="c1"># Multiple clients for resilience</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">llm_client</span><span class="o">=</span><span class="p">[</span><span class="n">client1</span><span class="p">,</span> <span class="n">client2</span><span class="p">])</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_llm_revisions</span></code></dt><dd><p>The total number of times the LLM will be asked to generate a JSON output for the given input. A higher number increases the chances of a reliable consensus but also increases costs and latency.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">int</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">3</span></code></p></li>
<li><p><strong>Example</strong>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Request 5 different JSON outputs for the consensus process</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">num_llm_revisions</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max_validation_retries_per_revision</span></code></dt><dd><p>The maximum number of times the orchestrator will try to re-validate a single LLM revision if it fails schema validation. This is useful for correcting minor LLM errors automatically.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">int</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">2</span></code></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">consensus_threshold</span></code></dt><dd><p>The percentage of agreement required for a data point to be included in the final consensus output. For example, a threshold of <code class="docutils literal notranslate"><span class="pre">0.51</span></code> means at least 51% of the LLM revisions must agree on a value.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">float</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">0.51</span></code></p></li>
<li><p><strong>Example</strong>:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Require a strict 75% agreement</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">consensus_threshold</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">conflict_resolver</span></code></dt><dd><p>An optional function to resolve disagreements when the consensus threshold is not met for a specific field. If not provided, a default resolver is used, which typically omits the conflicting field.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">Callable</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">default_conflict_resolver</span></code></p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">analytics_collector</span></code></dt><dd><p>An optional instance for collecting detailed analytics. If not provided, a new <code class="docutils literal notranslate"><span class="pre">WorkflowAnalyticsCollector</span></code> instance is created automatically.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">Optional[WorkflowAnalyticsCollector]</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
<li><p><strong>See also</strong>: For more details, see the <a class="reference internal" href="analytics_collector.html"><span class="doc">Analytics Collector</span></a> documentation.</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">use_hierarchical_extraction</span></code></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, enables a more advanced extraction mode designed for deeply nested and complex data models. This mode breaks down the extraction into smaller, manageable parts, which can improve accuracy for complex schemas but may increase the number of LLM calls.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">bool</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">False</span></code></p></li>
<li><p><strong>See also</strong>: For a guide on how to use this feature, see <a class="reference internal" href="how_to/handle_complex_data_with_hierarchical_extraction.html"><span class="doc">How to Handle Complex Data with Hierarchical Extraction</span></a>.</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">logger</span></code></dt><dd><p>An optional <cite>logging.Logger</cite> instance. If not provided, a default logger is created.</p>
<ul class="simple">
<li><p><strong>Type</strong>: <code class="docutils literal notranslate"><span class="pre">Optional[logging.Logger]</span></code></p></li>
<li><p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">None</span></code></p></li>
</ul>
</dd>
</dl>
</section>
<section id="core-execution-methods">
<h2>Core Execution Methods<a class="headerlink" href="#core-execution-methods" title="Link to this heading">¶</a></h2>
<p>Once the orchestrator is configured, you can start processing documents using one of the two main methods: <code class="docutils literal notranslate"><span class="pre">synthesize()</span></code> and <code class="docutils literal notranslate"><span class="pre">synthesize_and_save()</span></code>.</p>
<dl>
<dt><code class="docutils literal notranslate"><span class="pre">synthesize()</span></code></dt><dd><p>This method performs the full extraction and consensus pipeline and returns the hydrated SQLModel objects without persisting them to the database. This is useful if you need to perform additional validation or processing before saving.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hydrated_objects</span> <span class="o">=</span> <span class="k">await</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">synthesize</span><span class="p">(</span>
    <span class="n">input_strings</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Text document 1...&quot;</span><span class="p">,</span> <span class="s2">&quot;Text document 2...&quot;</span><span class="p">],</span>
    <span class="n">db_session_for_hydration</span><span class="o">=</span><span class="n">db_session</span>  <span class="c1"># Optional: for relationship resolution</span>
<span class="p">)</span>
</pre></div>
</div>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">input_strings</span></code> (<code class="docutils literal notranslate"><span class="pre">List[str]</span></code>): A list of strings, where each string is a document to be processed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">db_session_for_hydration</span></code> (<code class="docutils literal notranslate"><span class="pre">Optional[Session]</span></code>): An optional SQLAlchemy session. If provided, the hydrator will use it to resolve relationships. If not, a temporary in-memory session is created.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">extraction_example_json</span></code> (<code class="docutils literal notranslate"><span class="pre">str</span></code>, optional): A JSON string that provides a few-shot example to the LLM, guiding it to produce a better-structured output. If not provided, the orchestrator will attempt to auto-generate one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_extraction_process</span></code> (<code class="docutils literal notranslate"><span class="pre">str</span></code>, optional): Custom, step-by-step instructions for the LLM on how to perform the extraction.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_extraction_guidelines</span></code> (<code class="docutils literal notranslate"><span class="pre">str</span></code>, optional): A list of rules or guidelines for the LLM to follow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">custom_final_checklist</span></code> (<code class="docutils literal notranslate"><span class="pre">str</span></code>, optional): A final checklist for the LLM to review before finalizing its output.</p></li>
</ul>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">synthesize_and_save()</span></code></dt><dd><p>This is the most common method for end-to-end processing. It calls <code class="docutils literal notranslate"><span class="pre">synthesize()</span></code> internally and then persists the resulting objects to the database within a single transaction. If any part of the process fails, it automatically rolls back the transaction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This will extract, hydrate, and save the objects to the DB</span>
<span class="n">saved_objects</span> <span class="o">=</span> <span class="k">await</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">synthesize_and_save</span><span class="p">(</span>
    <span class="n">input_strings</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Order confirmation text...&quot;</span><span class="p">],</span>
    <span class="n">db_session</span><span class="o">=</span><span class="n">db_session</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The parameters are the same as for <code class="docutils literal notranslate"><span class="pre">synthesize()</span></code>, except it requires a <code class="docutils literal notranslate"><span class="pre">db_session</span></code> to commit the transaction.</p>
</dd>
</dl>
</section>
<section id="concise-usage-example">
<h2>Concise Usage Example<a class="headerlink" href="#concise-usage-example" title="Link to this heading">¶</a></h2>
<p>This example provides a focused look at initializing and calling the orchestrator, assuming your models and database are already defined. For a full step-by-step guide, please see the <a class="reference internal" href="getting_started.html#getting-started"><span class="std std-ref">Getting Started: A Step-by-Step Tutorial</span></a> tutorial.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">extrai.core</span> <span class="kn">import</span> <span class="n">WorkflowOrchestrator</span>

<span class="c1"># Assume the following are already configured:</span>
<span class="c1"># - `YourRootModel`: Your top-level SQLModel class.</span>
<span class="c1"># - `your_llm_client`: An initialized LLM client.</span>
<span class="c1"># - `your_db_engine`: A SQLAlchemy engine.</span>

<span class="c1"># 1. Initialize the WorkflowOrchestrator</span>
<span class="n">orchestrator</span> <span class="o">=</span> <span class="n">WorkflowOrchestrator</span><span class="p">(</span>
    <span class="n">root_sqlmodel_class</span><span class="o">=</span><span class="n">YourRootModel</span><span class="p">,</span>
    <span class="n">llm_client</span><span class="o">=</span><span class="n">your_llm_client</span><span class="p">,</span>
    <span class="n">num_llm_revisions</span><span class="o">=</span><span class="mi">3</span>  <span class="c1"># Request 3 revisions for consensus</span>
<span class="p">)</span>

<span class="c1"># 2. Define the text to process</span>
<span class="n">unstructured_text</span> <span class="o">=</span> <span class="s2">&quot;Some text containing data about a Company and its Employees...&quot;</span>

<span class="c1"># 3. Run the extraction and save the results</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">run_extraction</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">your_db_engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">saved_objects</span> <span class="o">=</span> <span class="k">await</span> <span class="n">orchestrator</span><span class="o">.</span><span class="n">synthesize_and_save</span><span class="p">(</span>
            <span class="p">[</span><span class="n">unstructured_text</span><span class="p">],</span>
            <span class="n">db_session</span><span class="o">=</span><span class="n">session</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully extracted and saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">saved_objects</span><span class="p">)</span><span class="si">}</span><span class="s2"> objects.&quot;</span><span class="p">)</span>

<span class="c1"># Run the asynchronous function</span>
<span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_extraction</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="sqlmodel_generator.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">SQLModel Generator</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="concepts/consensus_mechanism.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">The Consensus Mechanism</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Elias Thouant
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Workflow Orchestrator</a><ul>
<li><a class="reference internal" href="#core-workflow">Core Workflow</a></li>
<li><a class="reference internal" href="#initialization-and-configuration">Initialization and Configuration</a></li>
<li><a class="reference internal" href="#core-execution-methods">Core Execution Methods</a></li>
<li><a class="reference internal" href="#concise-usage-example">Concise Usage Example</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    </body>
</html>